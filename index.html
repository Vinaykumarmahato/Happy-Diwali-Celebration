// assets/js/app.js рдХрд╛ рдкреВрд░рд╛ рдХреЛрдб

$(document).ready(function() {

    // --- рднрд╛рдЧ 1: рдЬрдм рдХреЛрдИ рд▓рд┐рдВрдХ рдХреЛ рдЦреЛрд▓реЗрдЧрд╛ рддреЛ рдирд╛рдо рджрд┐рдЦрд╛рдирд╛ ---
    // URL рд╕реЗ 'name' рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП
    var urlParams = new URLSearchParams(window.location.search);
    var friendName = urlParams.get('name');

    // рдЕрдЧрд░ URL рдореЗрдВ рдирд╛рдо рд╣реИ (рдЬреИрд╕реЗ ?name=Vinay)
    if (friendName) {
        // рдирд╛рдо рдХреЛ URL рд╕реЗ рдбрд┐рдХреЛрдб рдХрд░рдирд╛ (рддрд╛рдХрд┐ 'Vinay%20Kumar' рд╡рд╛рдкрд╕ 'Vinay Kumar' рдмрди рдЬрд╛рдП)
        var decodedName = decodeURIComponent(friendName);
        
        // рдирд╛рдо рдХреЛ h1 рдЯреИрдЧ рдореЗрдВ рджрд┐рдЦрд╛рдирд╛
        $('#wishingFriend-name').text(decodedName + " рдХреА рддрд░рдл рд╕реЗ");
        
        // рдбрд┐рдлрд╝реЙрд▓реНрдЯ "Wish you a Happy Diwali" рдХреЛ рдЫрд┐рдкрд╛рдирд╛
        $('.default-wish').addClass('is-hidden');
        
        // рдкрд░реНрд╕рдирд▓рд╛рдЗрдЬрд╝реНрдб рд╡рд┐рд╢ рд╣реЗрдбрд┐рдВрдЧреНрд╕ рдФрд░ рдЧрд┐рдлреНрдЯ рдмреЙрдХреНрд╕ рдХреЛ рджрд┐рдЦрд╛рдирд╛
        $('.wishing-friend').removeClass('is-hidden');
    }

    // --- рднрд╛рдЧ 2: рдЖрдкрдХреА рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ - рдореИрд╕реЗрдЬ рдХреЗ рд╕рд╛рде рд▓рд┐рдВрдХ рдХреЙрдкреА рдХрд░рдирд╛ ---
    // 'btnWishFriend' рдмрдЯрди рдХреЗ рдХреНрд▓рд┐рдХ рдЗрд╡реЗрдВрдЯ рдХреЛ рд╕реБрдирдирд╛
    $('#btnWishFriend').on('click', function() {
        
        // 1. рдЗрдирдкреБрдЯ рдлрд╝реАрд▓реНрдб рд╕реЗ рдирд╛рдо рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛
        var name = $('#txtUsername').val();
        
        // рдЕрдЧрд░ рдирд╛рдо рдЦрд╛рд▓реА рд╣реИ рддреЛ рдЕрд▓рд░реНрдЯ рджрд┐рдЦрд╛рдирд╛
        if (!name) {
            alert('Please enter your name!');
            return;
        }

        // 2. рд╢реЗрдпрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд▓рд┐рдВрдХ рдмрдирд╛рдирд╛
        // рдирд╛рдо рдХреЛ URL-рд╕реЗрдл рдмрдирд╛рдирд╛ (рдЬреИрд╕реЗ 'Vinay Kumar' рдХреЛ 'Vinay%20Kumar' рдореЗрдВ рдмрджрд▓рдирд╛)
        var encodedName = encodeURIComponent(name);
        
        // рд╡рд░реНрддрдорд╛рди рдкреЗрдЬ рдХрд╛ рдмреЗрд╕ URL рд▓реЗрдирд╛
        var baseUrl = window.location.origin + window.location.pathname;
        
        // рдирд╛рдо рдХреЗ рд╕рд╛рде рдкреВрд░рд╛ рд╢реЗрдпрд░ рд▓рд┐рдВрдХ
        var shareLink = baseUrl + '?name=' + encodedName;

        // 3. рдЦреВрдмрд╕реВрд░рдд рд╡рд┐рд╢ рдореИрд╕реЗрдЬ рддреИрдпрд╛рд░ рдХрд░рдирд╛ (рдЬреИрд╕рд╛ рдЖрдкрдиреЗ рдЪрд╛рд╣рд╛)
        // рдЖрдк рдЗрд╕ рдореИрд╕реЗрдЬ рдХреЛ рдЕрдкрдиреА рдкрд╕рдВрдж рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ
        var wishMessage = 
`ЁЯкФтЬи *${name}* рдиреЗ рдЖрдкрдХреЗ рд▓рд┐рдП рдПрдХ рд╢рд╛рдирджрд╛рд░ рджрд┐рд╡рд╛рд▓реА рд╡рд┐рд╢ рднреЗрдЬреА рд╣реИ! тЬиЁЯкФ

рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рд▓рд┐рдВрдХ рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░рдХреЗ рдЕрдкрдиреА рд╡рд┐рд╢реЗрд╖ рд╢реБрднрдХрд╛рдордирд╛рдПрдБ рджреЗрдЦреЗрдВ:
ЁЯСЗЁЯСЗ
${shareLink}`;

        // 4. рдореИрд╕реЗрдЬ рдФрд░ рд▓рд┐рдВрдХ рдХреЛ рдХреНрд▓рд┐рдкрдмреЛрд░реНрдб рдкрд░ рдХреЙрдкреА рдХрд░рдирд╛
        navigator.clipboard.writeText(wishMessage).then(function() {
            // рдХреЙрдкреА рд╕рдлрд▓ рд╣реЛрдиреЗ рдкрд░:
            // 'Send' рдЖрдЗрдХрди рдЫрд┐рдкрд╛рдирд╛
            $('#btnWishFriend .before-copy').addClass('is-hidden');
            // 'Link copied' рдЯреЗрдХреНрд╕реНрдЯ рдФрд░ рдЪреЗрдХ-рдорд╛рд░реНрдХ рджрд┐рдЦрд╛рдирд╛
            $('#btnWishFriend .after-copied').removeClass('is-hidden');

            // 2 рд╕реЗрдХрдВрдб рдХреЗ рдмрд╛рдж рдмрдЯрди рдХреЛ рд╡рд╛рдкрд╕ рд╕рд╛рдорд╛рдиреНрдп рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд▓рд╛рдирд╛
            setTimeout(function() {
                $('#btnWishFriend .before-copy').removeClass('is-hidden');
                $('#btnWishFriend .after-copied').addClass('is-hidden');
            }, 2000);

        }).catch(function(err) {
            // рдХреЙрдкреА рд╡рд┐рдлрд▓ рд╣реЛрдиреЗ рдкрд░
            console.error('Failed to copy text: ', err);
            alert('Failed to copy link. Please copy it manually.');
        });
    });

    // --- (рдмрд╛рдХреА рдХрд╛ app.js рдХреЛрдб, рдЬреИрд╕реЗ рдХрд┐ рдЖрддрд┐рд╢рдмрд╛рдЬреА (fireworks) рдпрд╛ рд╕реНрдХреНрд░реАрдирд╢реЙрдЯ) ---
    // ...
});
